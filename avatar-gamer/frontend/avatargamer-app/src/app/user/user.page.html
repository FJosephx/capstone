<ion-content [fullscreen]="true" class="user-content">
  <div class="content-wrapper">
    
    <!-- Card de bienvenida mejorado -->
    <div class="welcome-section">
      <div class="welcome-header">
        <div class="icon-container">
          <ion-icon name="happy-outline" class="welcome-icon"></ion-icon>
        </div>
        <div class="welcome-text">
          <h1 class="welcome-title">¡Hola, {{ userProfile?.username }}!</h1>
          <p class="welcome-subtitle">Toca tu asistente para iniciar chat o videollamada</p>
        </div>
        <ion-button fill="outline" size="small" (click)="logout()" class="logout-inline">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          <span>Salir</span>
        </ion-button>
      </div>
    </div>

    <!-- Tabs mejorados -->
    <ion-segment [(ngModel)]="activeTab" (ionChange)="segmentChanged($event)" mode="md" class="custom-segment">
      <ion-segment-button value="linked" class="segment-btn">
        <div class="segment-content">
          <ion-icon name="people-outline"></ion-icon>
          <span>Mis Asistentes</span>
        </div>
      </ion-segment-button>
      <ion-segment-button value="requests" class="segment-btn">
        <div class="segment-content">
          <ion-icon name="mail-outline"></ion-icon>
          <span>Solicitudes</span>
        </div>
      </ion-segment-button>
    </ion-segment>

    <!-- Tab: Asistentes Vinculados -->
    <div *ngIf="activeTab === 'linked'" class="tab-content">
      
      <!-- Loading state -->
      <div *ngIf="isLoading" class="loading-state">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Cargando asistentes...</p>
      </div>
      
      <!-- Lista de asistentes -->
      <div *ngIf="!isLoading && linkedOperators.length > 0" class="assistants-grid">
        <div class="assistant-card" *ngFor="let operator of linkedOperators" (click)="startChatWithOperator(operator)">
          <div class="assistant-card-header">
            <div class="assistant-avatar" [class.online]="operator.status === 'online'">
              <ion-icon name="person-circle"></ion-icon>
              <span class="status-indicator" *ngIf="operator.status === 'online'"></span>
            </div>
            <div class="assistant-info">
              <h3 class="assistant-name">{{ operator.username || 'Asistente' }}</h3>
              <div class="assistant-status" [class.online]="operator.status === 'online'">
                <ion-icon [name]="operator.status === 'online' ? 'radio-button-on' : 'radio-button-off'"></ion-icon>
                <span>{{ operator.status === 'online' ? 'En línea' : 'Desconectado' }}</span>
              </div>
            </div>
          </div>
          
          <div class="assistant-card-footer">
            <ion-button expand="block" class="chat-btn">
              <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
              <span>Hablar Ahora</span>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <div *ngIf="!isLoading && linkedOperators.length === 0" class="empty-state">
        <ion-icon name="people-outline" class="empty-icon"></ion-icon>
        <h3>Sin asistentes</h3>
        <p>Aún no tienes asistentes vinculados. Revisa tus solicitudes pendientes.</p>
      </div>
    </div>
    
    <!-- Tab: Solicitudes Pendientes -->
    <div *ngIf="activeTab === 'requests'" class="tab-content">
      
      <!-- Loading state -->
      <div *ngIf="isLoading" class="loading-state">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Cargando solicitudes...</p>
      </div>
      
      <!-- Lista de solicitudes -->
      <div *ngIf="!isLoading && pendingRequests.length > 0" class="requests-list">
        <div class="request-item" *ngFor="let request of pendingRequests">
          <div class="request-icon">
            <ion-icon name="person-add-outline"></ion-icon>
          </div>
          <div class="request-info">
            <h3 class="request-username">{{ request.operator_username }}</h3>
            <p class="request-message" *ngIf="request.message">{{ request.message }}</p>
            <p class="request-date">Recibida: {{ request.created_at | date:'short' }}</p>
          </div>
          <div class="request-actions">
            <ion-button fill="clear" size="small" (click)="respondToRequest(request, 'approved')" class="approve-btn">
              <ion-icon name="checkmark-circle" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button fill="clear" size="small" (click)="respondToRequest(request, 'rejected')" class="reject-btn">
              <ion-icon name="close-circle" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <div *ngIf="!isLoading && pendingRequests.length === 0" class="empty-state">
        <ion-icon name="mail-outline" class="empty-icon"></ion-icon>
        <h3>Sin solicitudes</h3>
        <p>No tienes solicitudes pendientes en este momento</p>
      </div>
    </div>
    
    <!-- Botón de IA -->
    <ion-button expand="block" class="ai-button" (click)="navigateToAIChat()">
      <ion-icon name="sparkles-outline" slot="start"></ion-icon>
      <span>Hablar con Asistente Virtual</span>
    </ion-button>

  </div>
</ion-content>
