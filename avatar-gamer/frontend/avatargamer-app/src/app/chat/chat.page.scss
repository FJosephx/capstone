/* chat.page.scss – Módulo Chat
   AA+, foco visible, dark-mode, áreas táctiles grandes, y animaciones suaves. */

/* ===== Contenedores principales ===== */
ion-content {
  --background: linear-gradient(180deg, var(--ag-bg), color-mix(in oklab, var(--ag-bg), #dbeafe 10%));
}

ion-content.video-active {
  --background: var(--ag-bg);
}

.contact-header {
  --background: transparent;
  --color: var(--ion-color-primary-contrast);
  padding-inline: 0;
  ion-avatar {
    width: 40px; height: 40px;
    background: color-mix(in oklab, var(--ag-surface), #000 10%);
    border: 1px solid var(--ion-border-color);
    display: grid; place-items: center;
    ion-icon { font-size: 24px; }
  }
  ion-label h2 {
    margin: 0;
    font-weight: 800;
    letter-spacing: .01em;
  }
  ion-badge {
    font-weight: 800;
    margin-top: .15rem;
  }
}

/* ===== Banner de conexión ===== */
.connection-banner {
  border-radius: 12px;
  margin: var(--ag-space-sm) var(--ag-space-sm) 0;
  box-shadow: var(--ag-shadow-sm);
  --background: color-mix(in oklab, var(--ag-surface), #f59e0b 8%);
  ion-icon { font-size: 22px; }
  h3 { margin: 0 0 .125rem; font-weight: 700; }
  p { margin: 0; color: var(--ag-text); }
}

/* ===== Mensajería ===== */
.chat-container {
  display: grid;
  gap: .5rem;
  padding: var(--ag-space-sm);
  padding-bottom: calc(var(--ag-space-lg) + 56px); /* espacio para footer */
  min-height: 40vh;
}

.message {
  display: flex;
  width: 100%;
  animation: ag-fade-up var(--ag-t-norm) var(--ag-ease);
}

.message-incoming { justify-content: flex-start; }
.message-outgoing { justify-content: flex-end; }

.message-bubble {
  max-width: min(90%, 680px);
  border-radius: 16px;
  padding: .625rem .75rem .5rem;
  box-shadow: var(--ag-shadow-sm);
  border: 1px solid var(--ion-border-color);
  background: var(--ag-surface);
  color: var(--ag-text);
}

.message-outgoing .message-bubble {
  background: color-mix(in oklab, var(--ag-primary), white 12%);
  color: var(--ag-on-primary);
  border-color: color-mix(in oklab, var(--ag-primary), white 25%);
}

.message-text {
  font-size: 1rem;
  line-height: 1.45;
  word-wrap: break-word;
  white-space: pre-wrap;
}

.message-meta {
  display: flex;
  gap: .5rem;
  align-items: baseline;
  margin-top: .25rem;
  font-size: .825rem;
  opacity: .9;
}

.message-author { font-weight: 700; }
.message-time   { opacity: .9; }

/* ===== Estado vacío ===== */
.empty-state {
  margin: 12vh auto 0;
  text-align: center;
  color: var(--ag-muted);
  max-width: 520px;
  ion-icon { font-size: 64px; opacity: .6; margin-bottom: .5rem; }
  p { margin: 0; font-size: 1.05rem; }
}

/* ===== Videollamada ===== */
.video-call-container {
  height: calc(100vh - 56px - env(safe-area-inset-top));
  background: #000;
}

/* ===== Footer / Composer ===== */
ion-footer {
  --background: var(--ag-surface);
  border-top: 1px solid var(--ion-border-color);
  box-shadow: 0 -8px 20px rgba(2,6,23,.06);
}

ion-toolbar {
  --background: var(--ag-surface);
  padding: .35rem .25rem;
}

.input-container {
  display: grid;
  grid-template-columns: auto 1fr auto auto;
  align-items: center;
  gap: .25rem;

  padding: .25rem;
  border-radius: 14px;
  background: color-mix(in oklab, var(--ag-surface), #000 3%);
  border: 1px solid var(--ion-border-color);
}

.input-container:focus-within {
  outline: var(--ag-focus);
  outline-offset: 2px;
  border-color: var(--ion-color-primary);
}

.input-container ion-button {
  --border-radius: 12px;
  min-height: 44px;
}

.input-container ion-input {
  --padding-start: 12px; --padding-end: 12px;
  --padding-top: 10px;   --padding-bottom: 10px;
  font-size: 1.05rem;
  min-height: 44px;
  background: transparent;
}

/* Botón de respuestas rápidas */
.input-container > ion-button:first-child {
  --background: transparent;
  --color: var(--ag-muted);
  --box-shadow: none;
}

/* Botón enviar */
.input-container > ion-button:last-child {
  --background: var(--ag-primary);
  --background-hover: var(--ag-primary-600);
  --background-activated: var(--ag-primary-600);
  --color: var(--ag-on-primary);
  font-weight: 800;
}

/* ===== Controles de voz ===== */
.voice-controls {
  position: relative;
  display: flex; align-items: center; gap: .25rem;
  min-height: 44px;
}

.voice-controls ion-button {
  --background: transparent;
  --box-shadow: none;
  --color: var(--ag-muted);
}

.voice-controls ion-button.recording {
  --color: var(--ion-color-danger);
}

.recording-indicator {
  display: flex; align-items: center; gap: .5rem;
  margin-left: .25rem;
  .pulse-ring {
    width: 10px; height: 10px; border-radius: 999px;
    background: var(--ion-color-danger);
    box-shadow: 0 0 0 0 rgba(185,28,28,.6);
    animation: ag-pulse 1.4s infinite;
  }
  .recording-status {
    display: inline-flex; align-items: center; gap: .35rem;
    background: color-mix(in oklab, var(--ag-surface), #b91c1c 6%);
    border: 1px solid color-mix(in oklab, #b91c1c, white 35%);
    color: var(--ion-color-danger-contrast, #fff);
    border-radius: 999px;
    padding: .15rem .5rem;
    .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ion-color-danger); }
    .label { font-weight: 700; font-size: .85rem; }
    .time  { font-variant-numeric: tabular-nums; font-size: .85rem; opacity: .9; }
  }
}

/* Errores/avisos voz */
.voice-error {
  display: block;
  padding: .25rem .25rem 0;
  font-size: .9rem;
}

/* ===== Animaciones ===== */
@keyframes ag-fade-up {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: none; }
}

@keyframes ag-pulse {
  0%   { box-shadow: 0 0 0 0 rgba(185, 28, 28, .6); }
  70%  { box-shadow: 0 0 0 8px rgba(185, 28, 28, 0); }
  100% { box-shadow: 0 0 0 0 rgba(185, 28, 28, 0); }
}

/* ===== Accesibilidad extra ===== */
:focus-visible { outline: var(--ag-focus); outline-offset: 2px; }

button, ion-button, ion-item, ion-input, ion-segment-button { min-height: 44px; }

/* ===== Responsivo ===== */
@media (min-width: 768px) {
  .chat-container { padding: var(--ag-space-md) calc(var(--ag-space-md) + .25rem); }
  .message-bubble { max-width: min(78%, 720px); }
}

@media (prefers-color-scheme: dark) {
  ion-content {
    --background: linear-gradient(180deg, var(--ag-bg), color-mix(in oklab, var(--ag-bg), #0f172a 12%));
  }
}
